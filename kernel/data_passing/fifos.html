

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fifos &mdash; Zephyr Project Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Zephyr Project Documentation" href="../../index.html"/>
        <link rel="up" title="Data Passing" href="data_passing.html"/>
        <link rel="next" title="Lifos" href="lifos.html"/>
        <link rel="prev" title="Data Passing" href="data_passing.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                1.6.99
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kernel.html">Zephyr Kernel Primer (version 2)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threads/threads.html">Threads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing/timing.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/memory.html">Memory Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../synchronization/synchronization.html">Synchronization</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="data_passing.html">Data Passing</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fifos</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#concepts">Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#suggested-uses">Suggested Uses</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#apis">APIs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lifos.html">Lifos</a></li>
<li class="toctree-l3"><a class="reference internal" href="stacks.html">Stacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="message_queues.html">Message Queues</a></li>
<li class="toctree-l3"><a class="reference internal" href="mailboxes.html">Mailboxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="pipes.html">Pipes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../other/other.html">Other Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../application/application.html">Application Development Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../porting/porting.html">Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/drivers.html">Device Drivers and Device Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystems/subsystems.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/samples.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/kconfig/index.html">Configuration Options Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/code.html">Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSING.html">Licensing of Zephyr Project components</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Zephyr Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../kernel.html">Zephyr Kernel Primer (version 2)</a> &raquo;</li>
      
          <li><a href="data_passing.html">Data Passing</a> &raquo;</li>
      
    <li>Fifos</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/kernel/data_passing/fifos.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fifos">
<span id="fifos-v2"></span><h1>Fifos</h1>
<p>A <em class="dfn">fifo</em> is a kernel object that implements a traditional
first in, first out (FIFO) queue, allowing threads and ISRs
to add and remove data items of any size.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#concepts" id="id1">Concepts</a></li>
<li><a class="reference internal" href="#implementation" id="id2">Implementation</a><ul>
<li><a class="reference internal" href="#defining-a-fifo" id="id3">Defining a Fifo</a></li>
<li><a class="reference internal" href="#writing-to-a-fifo" id="id4">Writing to a Fifo</a></li>
<li><a class="reference internal" href="#reading-from-a-fifo" id="id5">Reading from a Fifo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-uses" id="id6">Suggested Uses</a></li>
<li><a class="reference internal" href="#configuration-options" id="id7">Configuration Options</a></li>
<li><a class="reference internal" href="#apis" id="id8">APIs</a></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a></h2>
<p>Any number of fifos can be defined. Each fifo is referenced
by its memory address.</p>
<p>A fifo has the following key properties:</p>
<ul class="simple">
<li>A <strong>queue</strong> of data items that have been added but not yet removed.
The queue is implemented as a simple linked list.</li>
</ul>
<p>A fifo must be initialized before it can be used. This sets its queue to empty.</p>
<p>Fifo data items must be aligned on a 4-byte boundary, as the kernel reserves
the first 32 bits of an item for use as a pointer to the next data item in
the queue. Consequently, a data item that holds N bytes of application data
requires N+4 bytes of memory.</p>
<p>A data item may be <strong>added</strong> to a fifo by a thread or an ISR.
The item is given directly to a waiting thread, if one exists;
otherwise the item is added to the fifo&#8217;s queue.
There is no limit to the number of items that may be queued.</p>
<p>A data item may be <strong>removed</strong> from a fifo by a thread. If the fifo&#8217;s queue
is empty a thread may choose to wait for a data item to be given.
Any number of threads may wait on an empty fifo simultaneously.
When a data item is added, it is given to the highest priority thread
that has waited longest.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kernel does allow an ISR to remove an item from a fifo, however
the ISR must not attempt to wait if the fifo is empty.</p>
</div>
<p>If desired, <strong>multiple data items</strong> can be added to a fifo in a single operation
if they are chained together into a singly-linked list. This capability can be
useful if multiple writers are adding sets of related data items to the fifo,
as it ensures the data items in each set are not interleaved with other data
items. Adding multiple data items to a fifo is also more efficient than adding
them one at a time, and can be used to guarantee that anyone who removes
the first data item in a set will be able to remove the remaining data items
without waiting.</p>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id2">Implementation</a></h2>
<div class="section" id="defining-a-fifo">
<h3><a class="toc-backref" href="#id3">Defining a Fifo</a></h3>
<p>A fifo is defined using a variable of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_fifo</span></code>.
It must then be initialized by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv211k_fifo_initP6k_fifo" title="k_fifo_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_init()</span></code></a>.</p>
<p>The following code defines and initializes an empty fifo.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_fifo</span> <span class="n">my_fifo</span><span class="p">;</span>

<span class="n">k_fifo_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_fifo</span><span class="p">);</span>
</pre></div>
</div>
<p>Alternatively, an empty fifo can be defined and initialized at compile time
by calling <a class="reference internal" href="../../api/kernel_api.html#c.K_FIFO_DEFINE" title="K_FIFO_DEFINE"><code class="xref c c-macro docutils literal"><span class="pre">K_FIFO_DEFINE</span></code></a>.</p>
<p>The following code has the same effect as the code segment above.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">K_FIFO_DEFINE</span><span class="p">(</span><span class="n">my_fifo</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-to-a-fifo">
<h3><a class="toc-backref" href="#id4">Writing to a Fifo</a></h3>
<p>A data item is added to a fifo by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_fifo_putP6k_fifoPv" title="k_fifo_put"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put()</span></code></a>.</p>
<p>The following code builds on the example above, and uses the fifo
to send data to one or more consumer threads.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">data_item_t</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">fifo_reserved</span><span class="p">;</span>   <span class="cm">/* 1st word reserved for use by fifo */</span>
    <span class="p">...</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">data_item_t</span> <span class="n">tx_data</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">producer_thread</span><span class="p">(</span><span class="kt">int</span> <span class="n">unused1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* create data item to send */</span>
        <span class="n">tx_data</span> <span class="o">=</span> <span class="p">...</span>

        <span class="cm">/* send data to consumers */</span>
        <span class="n">k_fifo_put</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_fifo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tx_data</span><span class="p">);</span>

        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Additionally, a singly-linked list of data items can be added to a fifo
by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_fifo_put_listP6k_fifoPvPv" title="k_fifo_put_list"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put_list()</span></code></a> or <a class="reference internal" href="../../api/kernel_api.html#_CPPv216k_fifo_put_slistP6k_fifoP11sys_slist_t" title="k_fifo_put_slist"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put_slist()</span></code></a>.</p>
</div>
<div class="section" id="reading-from-a-fifo">
<h3><a class="toc-backref" href="#id5">Reading from a Fifo</a></h3>
<p>A data item is removed from a fifo by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_fifo_getP6k_fifo7int32_t" title="k_fifo_get"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_get()</span></code></a>.</p>
<p>The following code builds on the example above, and uses the fifo
to obtain data items from a producer thread,
which are then processed in some manner.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">consumer_thread</span><span class="p">(</span><span class="kt">int</span> <span class="n">unused1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">data_item_t</span>  <span class="o">*</span><span class="n">rx_data</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rx_data</span> <span class="o">=</span> <span class="n">k_fifo_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_fifo</span><span class="p">,</span> <span class="n">K_FOREVER</span><span class="p">);</span>

        <span class="cm">/* process fifo data item */</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id6">Suggested Uses</a></h2>
<p>Use a fifo to asynchronously transfer data items of arbitrary size
in a &#8220;first in, first out&#8221; manner.</p>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id7">Configuration Options</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li>None.</li>
</ul>
</div>
<div class="section" id="apis">
<h2><a class="toc-backref" href="#id8">APIs</a></h2>
<p>The following fifo APIs are provided by <code class="file docutils literal"><span class="pre">kernel.h</span></code>:</p>
<ul class="simple">
<li><a class="reference internal" href="../../api/kernel_api.html#c.K_FIFO_DEFINE" title="K_FIFO_DEFINE"><code class="xref c c-macro docutils literal"><span class="pre">K_FIFO_DEFINE</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv211k_fifo_initP6k_fifo" title="k_fifo_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_init()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_fifo_putP6k_fifoPv" title="k_fifo_put"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_fifo_put_listP6k_fifoPvPv" title="k_fifo_put_list"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put_list()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv216k_fifo_put_slistP6k_fifoP11sys_slist_t" title="k_fifo_put_slist"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_put_slist()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_fifo_getP6k_fifo7int32_t" title="k_fifo_get"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_fifo_get()</span></code></a></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lifos.html" class="btn btn-neutral float-right" title="Lifos" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="data_passing.html" class="btn btn-neutral" title="Data Passing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Intel Corporation, Wind River Systems, Inc.
      Last updated on Jan 26, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.6.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>