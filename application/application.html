

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Application Development Primer &mdash; Zephyr Project Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Zephyr Project Documentation" href="../index.html"/>
        <link rel="next" title="Porting Guides" href="../porting/porting.html"/>
        <link rel="prev" title="C++ Support for Applications" href="../kernel/other/cxx_support.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                1.6.99
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel/kernel.html">Zephyr Kernel Primer (version 2)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Application Development Primer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-structure">Application Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-definition">Application Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#makefiles">Makefiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#makefile-conventions">Makefile Conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-source-files">Adding Source Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-directories">Adding Directories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#application-makefile">Application Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-configuration">Application Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-board-configuration">Default Board Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overriding-default-configuration">Overriding Default Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#application-specific-code">Application-Specific Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-an-application">Build an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rebuilding-an-application">Rebuilding an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-an-application">Run an Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#application-debugging">Application Debugging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../porting/porting.html">Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/drivers.html">Device Drivers and Device Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../subsystems/subsystems.html">Subsystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/samples.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/kconfig/index.html">Configuration Options Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/code.html">Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSING.html">Licensing of Zephyr Project components</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Zephyr Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Application Development Primer</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/application/application.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="application-development-primer">
<span id="application"></span><h1>Application Development Primer</h1>
<div class="section" id="overview">
<h2>Overview</h2>
<p>The Zephyr Kernel&#8217;s build system is based on the Kbuild system used in the
Linux kernel.</p>
<p>The build system is an application-centric system and requires an application
build to initiate building the kernel source tree. The application build drives
the configuration and build process of both the application and kernel,
compiling them into a single binary.</p>
<p>The Zephyr Kernel&#8217;s base directory hosts the kernel source code, the
configuration options, and the kernel build definitions.</p>
<p>The files in the application directory links the kernel with the
application. It hosts the definitions of the application, for example,
application-specific configuration options and the application&#8217;s source code.</p>
<p>An application in the simplest form has the following structure:</p>
<ul class="simple">
<li><strong>Application source code files</strong>: An application typically provides one
or more application-specific files, written in C or assembly language. These
files are usually located in a sub-directory called <code class="file docutils literal"><span class="pre">src</span></code>.</li>
<li><strong>Kernel configuration files</strong>: An application typically provides
a configuration file (<code class="file docutils literal"><span class="pre">.conf</span></code>) that specifies values for one or more
kernel configuration options. If omitted, the application&#8217;s existing kernel
configuration option values are used; if no existing values are provided,
the kernel&#8217;s default configuration values are used.</li>
<li><strong>Makefile</strong>: This file tells the build system where to find the files
mentioned above, as well as the desired target board configuration.</li>
</ul>
<p>Once the application has been defined, it can be built with a single <code class="docutils literal"><span class="pre">make</span></code>
call.
The results of the build process are located in a sub-directory called
<code class="file docutils literal"><span class="pre">outdir/BOARD</span></code>. This directory contains the files generated by the build
process, the most notable of which are listed below.</p>
<ul class="simple">
<li>The <code class="file docutils literal"><span class="pre">.config</span></code> file that contains the configuration settings
used to build the application.</li>
<li>The various object files (<code class="file docutils literal"><span class="pre">.o</span></code> files and <code class="file docutils literal"><span class="pre">.a</span></code> files) containing
custom-built kernel and application-specific code.</li>
<li>The <code class="file docutils literal"><span class="pre">zephyr.elf</span></code> file that contains the final combined application and
kernel binary.</li>
</ul>
</div>
<div class="section" id="application-structure">
<h2>Application Structure</h2>
<p>Create one directory for your application and a sub-directory for the
application&#8217;s source code; this makes it easier to organize directories and
files in the structure that the kernel expects.</p>
<ol class="arabic">
<li><p class="first">Create an application directory structure outside of the kernel&#8217;s
installation directory tree. Often this is your workspace directory.</p>
</li>
<li><p class="first">In a console terminal, navigate to a location where you want your
application to reside.</p>
</li>
<li><p class="first">Create the application&#8217;s directory, enter:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir app
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directory and the path to it, are referred to in the documentation
as <code class="file docutils literal"><span class="pre">~/app</span></code>.</p>
</div>
</li>
<li><p class="first">Create a source code directory in your <code class="file docutils literal"><span class="pre">~/app</span></code>, enter:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> app
<span class="gp">$</span> mkdir src
</pre></div>
</div>
<p>The source code directory <code class="file docutils literal"><span class="pre">~/app/src</span></code> is created.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">-- app</span>
<span class="go">   |-- src</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="application-definition">
<h2>Application Definition</h2>
<p>An application is integrated into the build system by including the Makefile.inc
file provided.</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="cp">include $(ZEPHYR_BASE)/Makefile.inc</span>
</pre></div>
</div>
<p>The following predefined variables configure the development project:</p>
<ul class="simple">
<li><strong class="makevar">ZEPHYR_BASE</strong>: Sets the path to the kernel&#8217;s base directory.
This variable is usually set by the <code class="file docutils literal"><span class="pre">zephyr_env.sh</span></code> script.
It can be used to get the kernel&#8217;s base directory, as used in the
Makefile.inc inclusion above, or it can be overridden to select an
specific instance of the kernel.</li>
<li><strong class="makevar">PROJECT_BASE</strong>: Provides the developer&#8217;s application project
directory path. It is set by the <code class="file docutils literal"><span class="pre">Makefile.inc</span></code> file.</li>
<li><strong class="makevar">SOURCE_DIR</strong>: Overrides the default value for the application&#8217;s
source code directory. The developer source code directory is set to
<code class="file docutils literal"><span class="pre">$(PROJECT_BASE/)src/</span></code> by default. This directory name should end
with slash <strong>&#8216;/&#8217;</strong>.</li>
<li><strong class="makevar">BOARD</strong>: Selects the board that the application&#8217;s
build will use for the default configuration.</li>
<li><strong class="makevar">CONF_FILE</strong>: Indicates the name of a configuration fragment file.
This file includes the kconfig configuration values that override the
default configuration values.</li>
<li><strong class="makevar">O</strong>: Optional. Indicates the output directory that Kconfig uses.
The output directory stores all the files generated during the build
process. The default output directory is the <code class="file docutils literal"><span class="pre">$(PROJECT_BASE)/outdir</span></code>
directory.</li>
</ul>
</div>
<div class="section" id="makefiles">
<h2>Makefiles</h2>
<div class="section" id="id1">
<h3>Overview</h3>
<p>The build system defines a set of conventions for the correct use of Makefiles
in the kernel source directories. The correct use of Makefiles is driven by the
concept of recursion.</p>
<p>In the recursion model, each Makefile within a directory includes the source
code and any subdirectories to the build process. Each subdirectory follows
the same principle. Developers can focus exclusively in their own work. They
integrate their module with the build system by adding a very simple Makefile
following the recursive model.</p>
</div>
<div class="section" id="makefile-conventions">
<span id="id2"></span><h3>Makefile Conventions</h3>
<p>The following conventions restrict how to add modules and Makefiles to the
build system. These conventions ensure the correct implementation of the
recursive model.</p>
<ul class="simple">
<li>Each source code directory must contain a single Makefile. Directories
without a Makefile are not considered source code directories.</li>
<li>The scope of every Makefile is restricted to the contents of that directory.
A Makefile can only make a direct reference to files and subdirectories on the
same level or below.</li>
<li>Makefiles list the object files that are included in the link process. The
build system finds the source file that generates the object file by matching
the object file name to the source file.</li>
<li>Parent directories add their child directories into the recursion model.</li>
<li>The root Makefile adds the directories in the kernel base directory into the
recursion model.</li>
</ul>
</div>
<div class="section" id="adding-source-files">
<h3>Adding Source Files</h3>
<p>The Makefile must refer the source build indirectly, specifying the object file
that results from the source file using the <code class="docutils literal"><span class="pre">obj-y</span></code> variable. For
example, if the file that we want to add is a C file named <code class="file docutils literal"><span class="pre">&lt;file&gt;.c</span></code> the
following line should be added in the Makefile:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">+=</span> &lt;file&gt;.o
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The same method applies for assembly files with the .S extension.</p>
</div>
<p>Source files can be added conditionally using configuration options.  For
example, if the option <code class="docutils literal"><span class="pre">CONFIG_VAR</span></code> is set and it implies that a source
file must be added in the compilation process, then the following line adds the
source code conditionally:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>obj-$(CONFIG_VAR) += &lt;file&gt;.o
</pre></div>
</div>
</div>
<div class="section" id="adding-directories">
<h3>Adding Directories</h3>
<p>Add a subdirectory to the build system by editing the Makefile in its
directory.  The subdirectory is added using the <code class="docutils literal"><span class="pre">obj-y</span></code> variable. The
correct syntax to add a subdirectory into the build queue is:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">+=</span> &lt;directory_name&gt;/
</pre></div>
</div>
<p>The backslash at the end of the directory name signals the build system that a
directory, and not a file, is being added to the build queue.</p>
<p>The conventions require us to add only one directory per line and never to mix
source code with directory recursion in a single <code class="docutils literal"><span class="pre">obj-y</span></code> line. This
helps keep the readability of the Makefile by making it clear when an item adds
an additional lever of recursion.</p>
<p>Directories can also be conditionally added:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>obj-y-$(CONFIG_VAR) += &lt;directory_name&gt;/
</pre></div>
</div>
<p>The subdirectory must contain its own Makefile following the rules described in
<a class="reference internal" href="#makefile-conventions"><span class="std std-ref">Makefile Conventions</span></a>.</p>
</div>
</div>
<div class="section" id="application-makefile">
<h2>Application Makefile</h2>
<p>Create an application Makefile to define basic information, such as the board
configuration used by the application. The build system uses the Makefile to
build a <code class="file docutils literal"><span class="pre">zephyr.elf</span></code> image that contains both the application and the
kernel libraries.</p>
<ol class="arabic">
<li><p class="first">Open the <code class="file docutils literal"><span class="pre">Makefile</span></code> and add the following mandatory
entries using any standard text editor.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure that there is a space before and after each <code class="docutils literal"><span class="pre">=</span></code>.</p>
</div>
</li>
<li><p class="first">Add the name of the default board configuration for your application on a
new line:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">BOARD</span> <span class="o">=</span> board_configuration_name
</pre></div>
</div>
<p>The supported boards can be found in <a class="reference internal" href="../boards/boards.html#boards"><span class="std std-ref">Supported Boards</span></a>.</p>
</li>
<li><p class="first">Add the name of the default kernel configuration file for your
application on a new line:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">CONF_FILE</span> <span class="o">?=</span> kernel_configuration_name
</pre></div>
</div>
</li>
<li><p class="first">Include the mandatory <code class="file docutils literal"><span class="pre">Makefile</span></code> on a new line:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="cp">include ${ZEPHYR_BASE}/Makefile.inc</span>
</pre></div>
</div>
</li>
<li><p class="first">Save and close the <code class="file docutils literal"><span class="pre">Makefile</span></code>.</p>
</li>
</ol>
<p>Below is an example Makefile:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">BOARD</span> <span class="o">=</span> qemu_x86
<span class="nv">CONF_FILE</span> <span class="o">=</span> prj.conf

<span class="cp">include ${ZEPHYR_BASE}/Makefile.inc</span>
</pre></div>
</div>
</div>
<div class="section" id="application-configuration">
<h2>Application Configuration</h2>
<p>The application&#8217;s kernel is configured using a set of configuration options
that can be customized for application-specific purposes.
The Zephyr build system takes a configuration option&#8217;s value from the first
source in which it is specified.</p>
<p>The available sources are (in order):</p>
<ol class="arabic simple">
<li>The application&#8217;s current configuration. (i.e. The <code class="file docutils literal"><span class="pre">.config</span></code> file.)</li>
<li>The application&#8217;s default configuration. (i.e. The <code class="file docutils literal"><span class="pre">.conf</span></code> file.)</li>
<li>The board configuration used by the application.
(i.e. The board&#8217;s <code class="file docutils literal"><span class="pre">.defconfig</span></code> file.)</li>
<li>The kernel&#8217;s default configuration.
(i.e. One of the kernel&#8217;s <code class="file docutils literal"><span class="pre">Kconfig</span></code> files.)</li>
</ol>
<p>For information on available kernel configuration options, including
inter-dependencies between options, see the <a class="reference internal" href="../reference/kconfig/index.html#configuration"><span class="std std-ref">Configuration Options Reference Guide</span></a>.</p>
<div class="section" id="default-board-configuration">
<h3>Default Board Configuration</h3>
<p>An application&#8217;s <code class="file docutils literal"><span class="pre">.conf</span></code> file defines its default kernel configuration.
The settings in this file override or augment the board configuration settings.</p>
<p>The board configuration settings can be viewed
in <code class="file docutils literal"><span class="pre">$ZEPHYR_BASE/boards/ARCHITECTURE/BOARD/BOARD_defconfig</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the default board configuration settings are sufficient for your
application, a <code class="file docutils literal"><span class="pre">.conf</span></code> file is not needed. Skip ahead to
<a class="reference internal" href="#override-kernel-conf"><span class="std std-ref">Overriding Default Configuration</span></a>.</p>
</div>
<ol class="arabic">
<li><p class="first">Navigate to the <code class="file docutils literal"><span class="pre">app</span></code>, and create the <code class="file docutils literal"><span class="pre">prj.conf</span></code> file. Enter:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vim prj.conf
</pre></div>
</div>
<p>The default name is <code class="file docutils literal"><span class="pre">prj.conf</span></code>. The filename must match the
<code class="docutils literal"><span class="pre">CONF_FILE</span></code> entry in the application <code class="file docutils literal"><span class="pre">Makefile</span></code>.</p>
</li>
<li><p class="first">Edit the file and add the appropriate configuration entries.</p>
<ol class="loweralpha simple">
<li>Add each configuration entry on a new line.</li>
<li>Begin each entry with <code class="docutils literal"><span class="pre">CONFIG_</span></code>.</li>
<li>Ensure that each entry contains no spaces
(including on either side of the = sign).</li>
<li>Use a # followed by a space to comment a line.</li>
</ol>
<p>The example below shows a comment line and a board
configuration override in the <code class="file docutils literal"><span class="pre">prj.conf</span></code>.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp"># Enable printk for debugging</span>
<span class="n">CONFIG_PRINTK</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
</li>
<li><p class="first">Save and close the file.</p>
</li>
</ol>
</div>
<div class="section" id="overriding-default-configuration">
<span id="override-kernel-conf"></span><h3>Overriding Default Configuration</h3>
<p>Override the default board and kernel configuration to temporarily alter the
application&#8217;s configuration, perhaps to test the effect of a change.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to permanently alter the configuration you
should revise the <code class="file docutils literal"><span class="pre">.conf</span></code> file.</p>
</div>
<p>Configure the kernel options using a menu-driven interface. While you can add
entries manually, using the configuration menu is a preferred method.</p>
<ol class="arabic">
<li><p class="first">Run the <strong class="command">make menuconfig</strong> rule to launch the menu-driven interface.</p>
<ol class="loweralpha">
<li><p class="first">In a terminal session, navigate to the application directory
(<code class="file docutils literal"><span class="pre">~/app</span></code>).</p>
</li>
<li><p class="first">Enter the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make <span class="o">[</span><span class="nv">BOARD</span><span class="o">=</span>&lt;type&gt;<span class="o">]</span> menuconfig
</pre></div>
</div>
<p>A question-based menu opens that allows you to set individual configuration
options.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/app_kernel_conf_1.png"><img alt="Main Configuration Menu" class="align-center" src="../_images/app_kernel_conf_1.png" style="width: 400px; height: 375px;" /></a>
</div></blockquote>
</li>
</ol>
</li>
<li><p class="first">Set kernel configuration values using the following
key commands:</p>
<ul>
<li><p class="first">Use the arrow keys to navigate within any menu or list.</p>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to select a menu item.</p>
</li>
<li><dl class="first docutils">
<dt>Type an upper case <code class="kbd docutils literal"><span class="pre">Y</span></code> or <code class="kbd docutils literal"><span class="pre">N</span></code> in the</dt>
<dd><p class="first last">square brackets <span class="guilabel">[ ]</span> to
enable or disable a kernel configuration option.</p>
</dd>
</dl>
</li>
<li><p class="first">Type a numerical value in the round brackets <span class="guilabel">( )</span>.</p>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Tab</span></code> to navigate the command menu at the bottom of the display.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a non-default entry is selected for options that are nonnumerical,
an asterisk <code class="kbd docutils literal"><span class="pre">*</span></code> appears between the square brackets in the display.
There is nothing added added the display when you select the option&#8217;s
default.</p>
</div>
</li>
</ul>
</li>
<li><p class="first">For information about any option, select the option and tab to
<span class="guilabel">&lt;Help &gt;</span> and press <code class="kbd docutils literal"><span class="pre">Enter</span></code>.</p>
<p>Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to return to the menu.</p>
</li>
<li><p class="first">After configuring the kernel options for your application, tab to
<span class="guilabel">&lt; Save &gt;</span> and press <code class="kbd docutils literal"><span class="pre">Enter</span></code>.</p>
<p>The following dialog opens with the <span class="guilabel">&lt; Ok &gt;</span> command selected:</p>
<a class="reference internal image-reference" href="../_images/app_kernel_conf_2.png"><img alt="Save Configuration Dialog" class="align-center" src="../_images/app_kernel_conf_2.png" style="width: 400px; height: 100px;" /></a>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to save the kernel configuration options to the default
file name; alternatively, type a file name and press <code class="kbd docutils literal"><span class="pre">Enter</span></code>.</p>
<p>Typically, you will save to the default file name unless you are
experimenting with various configuration scenarios.</p>
<p>An <code class="file docutils literal"><span class="pre">outdir</span></code> directory is created in the application directory. The
outdir directory contains symbolic links to files under
<code class="file docutils literal"><span class="pre">$ZEPHYR_BASE</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At present, only a <code class="file docutils literal"><span class="pre">.config</span></code> file can be built. If you have saved
files with different file names and want to build with one of these,
change the file name to <code class="file docutils literal"><span class="pre">.config</span></code>. To keep your original
<code class="file docutils literal"><span class="pre">.config</span></code>, rename it to something other than <code class="file docutils literal"><span class="pre">.config</span></code>.</p>
</div>
<p>Kernel configuration files, such as the <code class="file docutils literal"><span class="pre">.config</span></code> file, are saved
as hidden files in <code class="file docutils literal"><span class="pre">outdir</span></code>. To list all your kernel configuration
files, enter <strong class="command">ls -a</strong> at the terminal prompt.</p>
<p>The following dialog opens, displaying the file name the configuration
was saved to.</p>
<a class="reference internal image-reference" href="../_images/app_kernel_conf_3.png"><img alt="Saved Configuration Name Dialog" class="align-center" src="../_images/app_kernel_conf_3.png" style="width: 400px; height: 150px;" /></a>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to return to the options menu.</p>
</li>
<li><p class="first">To load any saved kernel configuration file, tab to <span class="guilabel">&lt; Load &gt;</span> and
press <code class="kbd docutils literal"><span class="pre">Enter</span></code>.</p>
<p>The following dialog opens with the <span class="guilabel">&lt; Ok &gt;</span> command selected:</p>
<a class="reference internal image-reference" href="../_images/app_kernel_conf_4.png"><img alt="Configuration File Load Dialog" class="align-center" src="../_images/app_kernel_conf_4.png" style="width: 400px; height: 175px;" /></a>
</li>
<li><p class="first">To load the last saved kernel configuration file, press <span class="guilabel">&lt; Ok &gt;</span>,
or to load another saved configuration file, type the file name, then select
<span class="guilabel">&lt; Ok &gt;</span>.</p>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to load the file and return to the main menu.</p>
</li>
<li><p class="first">To exit the menu configuration, tab to <span class="guilabel">&lt; Exit &gt;</span> and press
<code class="kbd docutils literal"><span class="pre">Enter</span></code>.</p>
<p>The following confirmation dialog opens with the <span class="guilabel">&lt; Yes &gt;</span>
command selected.</p>
<a class="reference internal image-reference" href="../_images/app_kernel_conf_5.png"><img alt="Exit Dialog" class="align-center" src="../_images/app_kernel_conf_5.png" style="width: 400px; height: 100px;" /></a>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Enter</span></code> to retire the menu display and return to the console
command line.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="application-specific-code">
<h2>Application-Specific Code</h2>
<p>Application-specific source code files are normally added to the application&#8217;s
<code class="file docutils literal"><span class="pre">src</span></code> directory. If the application adds a large number of files the
developer can group them into sub-directories under <code class="file docutils literal"><span class="pre">src</span></code>, to whatever
depth is needed. The developer must supply a <code class="file docutils literal"><span class="pre">Makefile</span></code> for the
<code class="file docutils literal"><span class="pre">src</span></code> directory, as well as for each sub-directory under <code class="file docutils literal"><span class="pre">src</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These Makefiles are distinct from the top-level application Makefile
that appears in <code class="file docutils literal"><span class="pre">~/app</span></code>.</p>
</div>
<p>Application-specific source code should not use symbol name prefixes that have
been reserved by the kernel for its own use. For more information, see</p>
<p><a class="reference external" href="https://wiki.zephyrproject.org/view/Coding_conventions#Naming_Conventions">Naming Conventions</a>.</p>
<p>The following requirements apply to all Makefiles in the <code class="file docutils literal"><span class="pre">src</span></code>
directory, including any sub-directories it may have.</p>
<ul>
<li><p class="first">During the build process, Kbuild identifies the source files to compile
into object files by matching the file names identified in
the application&#8217;s Makefile(s).</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A source file that is not referenced by any Makefile is not included
when the application is built.</p>
</div>
</li>
<li><p class="first">A Makefile cannot directly reference source code. It can only
reference object files (<code class="file docutils literal"><span class="pre">.o</span></code> files) produced from source code files.</p>
</li>
<li><p class="first">A Makefile can only reference files in its own directory or in the
sub-directories of that directory.</p>
</li>
<li><p class="first">A Makefile may reference multiple files from a single-line entry.
However, a separate line must be used to reference each directory.</p>
</li>
</ul>
<ol class="arabic">
<li><p class="first">Create a directory structure for your source code in <code class="file docutils literal"><span class="pre">src</span></code>
and add your source code files to it.</p>
</li>
<li><p class="first">Create a <code class="file docutils literal"><span class="pre">Makefile</span></code> in the <code class="file docutils literal"><span class="pre">src</span></code> directory. Then create
an additional <code class="file docutils literal"><span class="pre">Makefile</span></code> in each of the sub-directories under
the <code class="file docutils literal"><span class="pre">src</span></code> directory, if any.</p>
<ol class="loweralpha">
<li><p class="first">Use the following syntax to add file references:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">+=</span> file1.o file2.o
</pre></div>
</div>
</li>
<li><p class="first">Use the following syntax to add directory references:</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">+=</span> directory_name/**
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<p>This example is taken from the Philosopher&#8217;s Sample. To examine this file in
context, navigate to: <code class="file docutils literal"><span class="pre">$ZEPHYR_BASE/samples/philosophers/src</span></code>.</p>
<div class="highlight-make"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">=</span> main.o
</pre></div>
</div>
</div>
<div class="section" id="build-an-application">
<h2>Build an Application</h2>
<p>The Zephyr build system compiles and links all components of an application
into a single application image that can be run on simulated hardware or real
hardware.</p>
<ol class="arabic">
<li><p class="first">Navigate to the application directory <code class="file docutils literal"><span class="pre">~/app</span></code>.</p>
</li>
<li><p class="first">Enter the following command to build the application&#8217;s <code class="file docutils literal"><span class="pre">zephyr.elf</span></code>
image using the configuration settings for the board type specified
in the application&#8217;s <code class="file docutils literal"><span class="pre">Makefile</span></code>.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make
</pre></div>
</div>
<p>If desired, you can build the application using the configuration settings
specified in an alternate <code class="file docutils literal"><span class="pre">.conf</span></code> file using the <code class="code docutils literal"><span class="pre">CONF_FILE</span></code>
parameter. These settings will override the settings in the application&#8217;s
<code class="file docutils literal"><span class="pre">.config</span></code> file or its default <code class="file docutils literal"><span class="pre">.conf</span></code> file. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make <span class="nv">CONF_FILE</span><span class="o">=</span>prj.alternate.conf
</pre></div>
</div>
<p>If desired, you can build the application for a different board type than the
one specified in the application&#8217;s <code class="file docutils literal"><span class="pre">Makefile</span></code> using the <code class="code docutils literal"><span class="pre">BOARD</span></code>
parameter. For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make <span class="nv">BOARD</span><span class="o">=</span>arduino_101
</pre></div>
</div>
<p>Both the <code class="code docutils literal"><span class="pre">CONF_FILE</span></code> and <code class="code docutils literal"><span class="pre">BOARD</span></code> parameters can be specified
when building the application.</p>
</li>
</ol>
</div>
<div class="section" id="rebuilding-an-application">
<h2>Rebuilding an Application</h2>
<p>Application development is usually fastest when changes are continually tested.
Frequently rebuilding your application makes debugging less painful
as the application becomes more complex. It&#8217;s usually a good idea to
rebuild and test after any major changes to the application&#8217;s source files,
Makefiles, or configuration settings.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The Zephyr build system rebuilds only the parts of the application image
potentially affected by the changes. Consequently, rebuilding an application
is often significantly faster than building it the first time.</p>
</div>
<p>Sometimes the build system doesn&#8217;t rebuild the application correctly
because it fails to recompile one or more necessary files. You can force
the build system to rebuild the entire application from scratch with the
following procedure:</p>
<ol class="arabic">
<li><p class="first">Navigate to the application directory <code class="file docutils literal"><span class="pre">~/app</span></code>.</p>
</li>
<li><p class="first">Enter the following command to delete the application&#8217;s generated files
for the specified board type, except for the <code class="file docutils literal"><span class="pre">.config</span></code> file that
contains the application&#8217;s current configuration information.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make <span class="o">[</span><span class="nv">BOARD</span><span class="o">=</span>&lt;type&gt;<span class="o">]</span> clean
</pre></div>
</div>
<p>Alternatively, enter the following command to delete <em>all</em> generated files
for <em>all</em> board types, including the <code class="file docutils literal"><span class="pre">.config</span></code> files that contain
the application&#8217;s current configuration information for those board types.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make pristine
</pre></div>
</div>
</li>
<li><p class="first">Rebuild the application normally following the steps specified
in <a class="reference internal" href="#build-an-application">Build an Application</a> above.</p>
</li>
</ol>
</div>
<div class="section" id="run-an-application">
<h2>Run an Application</h2>
<p>An application image can be run on real or emulated hardware. The kernel has
built-in emulator support for QEMU. It allows you to run and test an application
virtually, before (or in lieu of) loading and running it on actual target
hardware.</p>
<ol class="arabic">
<li><p class="first">Open a terminal console and navigate to the application directory
<code class="file docutils literal"><span class="pre">~/app</span></code>.</p>
</li>
<li><p class="first">Enter the following command to build and run the application
using a QEMU-supported board configuration, such as qemu_cortex_m3 or
qemu_x86.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> make <span class="o">[</span><span class="nv">BOARD</span><span class="o">=</span>&lt;type&gt; ...<span class="o">]</span> run
</pre></div>
</div>
<p>The Zephyr build system generates a <code class="file docutils literal"><span class="pre">zephyr.elf</span></code> image file
and then begins running it in the terminal console.</p>
</li>
<li><p class="first">Press <code class="kbd docutils literal"><span class="pre">Ctrl</span> <span class="pre">A,</span> <span class="pre">X</span></code> to stop the application from running
in QEMU.</p>
<p>The application stops running and the terminal console prompt
redisplays.</p>
</li>
</ol>
</div>
<div class="section" id="application-debugging">
<h2>Application Debugging</h2>
<p>This section is a quick hands-on reference to start debugging your
application with QEMU. Most content in this section is already covered on
<a class="reference external" href="http://wiki.qemu.org/Main_Page">QEMU</a> and <a class="reference external" href="http://www.gnu.org/software/gdb">GNU_Debugger</a> reference manuals.</p>
<p>In this quick reference you find shortcuts, specific environmental variables and
parameters that can help you to quickly set up your debugging environment.</p>
<p>The simplest way to debug an application running in QEMU is using the GNU
Debugger and setting a local GDB server in your development system through QEMU.</p>
<p>You will need an ELF binary image for debugging purposes.  The build system
generates the image in the output directory.  By default, the kernel binary name
is <code class="file docutils literal"><span class="pre">zephyr.elf</span></code>. The name can be changed using a Kconfig option.</p>
<p>We will use the standard 1234 TCP port to open a <abbr title="GNU Debugger">GDB</abbr>
server instance. This port number can be changed for a port that best suits the
development environment.</p>
<p>You can run Qemu to listen for a &#8220;gdb connection&#8221; before it starts executing any
code to debug it.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>qemu -s -S &lt;image&gt;
</pre></div>
</div>
<p>will setup Qemu to listen on port 1234 and wait for a GDB connection to it.</p>
<p>The options used above have the following meaning:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-S</span></code> Do not start CPU at startup; rather, you must type &#8216;c&#8217; in the
monitor.</li>
<li><code class="docutils literal"><span class="pre">-s</span></code> Shorthand for <code class="docutils literal"><span class="pre">-gdb</span> <span class="pre">tcp::1234</span></code>: open a GDB server on
TCP port 1234.</li>
</ul>
<p>To debug with QEMU and to start a GDB server and wait for a remote connect, run
the following inside an application:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>make <span class="nv">BOARD</span><span class="o">=</span>qemu_x86 debugserver
</pre></div>
</div>
<p>The build system will start a QEMU instance with the CPU halted at startup
and with a GDB server instance listening at the TCP port 1234.</p>
<p>Using a local GDB configuration <code class="file docutils literal"><span class="pre">.gdbinit</span></code> can help initialize your GDB
instance on every run.
In this example, the initialization file points to the GDB server instance.
It configures a connection to a remote target at the local host on the TCP
port 1234. The initialization sets the kernel&#8217;s root directory as a
reference.</p>
<p>The <code class="file docutils literal"><span class="pre">.gdbinit</span></code> file contains the following lines:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>target remote localhost:1234
dir ZEPHYR_BASE
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Substitute ZEPHYR_BASE for the current kernel&#8217;s root directory.</p>
</div>
<p>Execute the application to debug from the same directory that you chose for
the <code class="file docutils literal"><span class="pre">gdbinit</span></code> file. The command can include the <code class="docutils literal"><span class="pre">--tui</span></code> option
to enable the use of a terminal user interface. The following commands
connects to the GDB server using <code class="file docutils literal"><span class="pre">gdb</span></code>. The command loads the symbol
table from the elf binary file. In this example, the elf binary file name
corresponds to <code class="file docutils literal"><span class="pre">zephyr.elf</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ gdb --tui zephyr.elf
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The GDB version on the development system might not support the &#8211;tui
option.</p>
</div>
<p>If you are not using a .gdbinit file, issue the following command inside GDB to
connect to the remove GDB server on port 1234:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">(</span>gdb<span class="o">)</span> target remote localhost:1234
</pre></div>
</div>
<p>Finally, The command below connects to the GDB server using the Data
Displayer Debugger (<code class="file docutils literal"><span class="pre">ddd</span></code>). The command loads the symbol table from the
elf binary file, in this instance, the <code class="file docutils literal"><span class="pre">zephyr.elf</span></code> file.</p>
<p>The <abbr title="Data Displayer Debugger">DDD</abbr> may not be installed in your
development system by default. Follow your system instructions to install
it.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ddd --gdb --debugger <span class="s2">&quot;gdb zephyr.elf&quot;</span>
</pre></div>
</div>
<p>Both commands execute the <abbr title="GNU Debugger">gdb</abbr>. The command name might
change depending on the toolchain you are using and your cross-development
tools.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../porting/porting.html" class="btn btn-neutral float-right" title="Porting Guides" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../kernel/other/cxx_support.html" class="btn btn-neutral" title="C++ Support for Applications" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Intel Corporation, Wind River Systems, Inc.
      Last updated on Jan 26, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.6.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>