

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Test Framework &mdash; Zephyr Project Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Zephyr Project Documentation" href="../../index.html"/>
        <link rel="up" title="Subsystems" href="../subsystems.html"/>
        <link rel="next" title="USB device stack" href="../usb/usb.html"/>
        <link rel="prev" title="Shell" href="../shell.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                1.6.99
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/kernel.html">Zephyr Kernel Primer (version 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/application.html">Application Development Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../porting/porting.html">Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drivers/drivers.html">Device Drivers and Device Model</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../subsystems.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/bluetooth.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c_library.html">Standard C Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/networking.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../power_management.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sensor.html">Sensor Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell.html">Shell</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Test Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quick-start-integration-testing">Quick start - Integration testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quick-start-unit-testing">Quick start - Unit testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-reference">API reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-tests">Running tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#assertions">Assertions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mocking">Mocking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../usb/usb.html">USB device stack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/samples.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/kconfig/index.html">Configuration Options Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/code.html">Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSING.html">Licensing of Zephyr Project components</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Zephyr Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../subsystems.html">Subsystems</a> &raquo;</li>
      
    <li>Test Framework</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/subsystems/test/ztest.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="test-framework">
<span id="testing"></span><h1>Test Framework</h1>
<p>The Zephyr Test Framework (Ztest) provides a simple testing framework intended
to be used during development.  It provides basic assertion macros and a generic
test structure.</p>
<p>The framework can be used in two ways, either as a generic framework for
integration testing, or for unit testing specific modules.</p>
<div class="section" id="quick-start-integration-testing">
<h2>Quick start - Integration testing</h2>
<p>A simple working base is located at <cite>samples/testing/integration</cite>. Just copy the
files to <cite>tests/</cite> and edit them for your needs. The test will then be
automatically built and run by the sanitycheck script. If you are testing the <cite>bar</cite>
component of <cite>foo</cite>, you should copy the sample folder to tests/foo/bar. It can
then be tested with <cite>./scripts/sanitycheck -s tests/foo/bar/test</cite>.</p>
<p>The sample contains the following files:</p>
<p>Makefile</p>
<div class="highlight-Make"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">BOARD</span> <span class="o">?=</span> qemu_x86
<span class="nv">CONF_FILE</span> <span class="o">?=</span> prj.conf

<span class="cp">include $(ZEPHYR_BASE)/Makefile.inc</span>
</pre></div>
</td></tr></table></div>
<p>testcase.ini</p>
<div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">[test]</span>
<span class="na">tags</span> <span class="o">=</span> <span class="s">my_tags</span>
</pre></div>
</td></tr></table></div>
<p>prj.conf</p>
<div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>CONFIG_ZTEST=y
</pre></div>
</td></tr></table></div>
<p>src/Makefile</p>
<div class="highlight-Make"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">obj-y</span> <span class="o">=</span> main.o

<span class="cp">include $(ZEPHYR_BASE)/tests/Makefile.test</span>
</pre></div>
</td></tr></table></div>
<p>src/main.c</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2016 Intel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * SPDX-License-Identifier: Apache-2.0</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">assert_tests</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">assert_true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;1 was false&quot;</span><span class="p">);</span>
	<span class="n">assert_false</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;0 was true&quot;</span><span class="p">);</span>
	<span class="n">assert_is_null</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;NULL was not NULL&quot;</span><span class="p">);</span>
	<span class="n">assert_not_null</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">foo</span><span class="se">\&quot;</span><span class="s"> was NULL&quot;</span><span class="p">);</span>
	<span class="n">assert_equal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;1 was not equal to 1&quot;</span><span class="p">);</span>
	<span class="n">assert_equal_ptr</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;NULL was not equal to NULL&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">framework_tests</span><span class="p">,</span>
		<span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">assert_tests</span><span class="p">)</span>
	<span class="p">);</span>

	<span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">framework_tests</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="quick-start-unit-testing">
<h2>Quick start - Unit testing</h2>
<p>Ztest can be used for unit testing. This means that rather than including the
entire Zephyr OS for testing a single function, you can focus the testing
efforts into the specific module in question. This will speed up testing since
only the module will have to be compiled in, and the tested functions will be
called directly.</p>
<p>Since you won&#8217;t be including basic kernel data structures that most code
depends on, you have to provide function stubs in the test. Ztest provides
some helpers for mocking functions, as demonstrated below.</p>
<p>In a unit test, mock objects can simulate the behavior of complex real objects
and are used to decide whether a test failed or passed by verifying whether an
interaction with an object occurred, and if required, to assert the order of
that interaction.</p>
<p>The <cite>samples/testing/unit</cite> folder contains an example for testing
the net-buf api of Zephyr.</p>
<p>Makefile</p>
<div class="highlight-Make"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">INCLUDE</span> <span class="o">+=</span> subsys

<span class="cp">include $(ZEPHYR_BASE)/tests/unit/Makefile.unittest</span>
</pre></div>
</td></tr></table></div>
<p>testcase.ini</p>
<div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">[test]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">unit</span>
<span class="na">tags</span> <span class="o">=</span> <span class="s">buf</span>
</pre></div>
</td></tr></table></div>
<p>main.c</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2016 Intel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * SPDX-License-Identifier: Apache-2.0</span>
<span class="cm"> */</span>

<span class="cp">#include</span> <span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">irq_lock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">irq_unlock</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cp">#include</span> <span class="cpf">&lt;net/buf.c&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">k_fifo_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_fifo</span> <span class="o">*</span><span class="n">fifo</span><span class="p">)</span> <span class="p">{}</span>
<span class="kt">void</span> <span class="nf">k_fifo_put_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_fifo</span> <span class="o">*</span><span class="n">fifo</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">head</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">tail</span><span class="p">)</span> <span class="p">{}</span>

<span class="kt">int</span> <span class="nf">k_is_in_isr</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">k_fifo_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_fifo</span> <span class="o">*</span><span class="n">fifo</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">k_fifo_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_fifo</span> <span class="o">*</span><span class="n">fifo</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">k_lifo_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_lifo</span> <span class="o">*</span><span class="n">lifo</span><span class="p">)</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="o">*</span><span class="nf">k_lifo_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_lifo</span> <span class="o">*</span><span class="n">lifo</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">k_lifo_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_lifo</span> <span class="o">*</span><span class="n">lifo</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cp">#define TEST_BUF_COUNT 1</span>
<span class="cp">#define TEST_BUF_SIZE 74</span>

<span class="n">NET_BUF_POOL_DEFINE</span><span class="p">(</span><span class="n">bufs_pool</span><span class="p">,</span> <span class="n">TEST_BUF_COUNT</span><span class="p">,</span> <span class="n">TEST_BUF_SIZE</span><span class="p">,</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">test_get_single_buffer</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">net_buf_alloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bufs_pool</span><span class="p">,</span> <span class="n">K_NO_WAIT</span><span class="p">);</span>

	<span class="n">assert_equal</span><span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">ref</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Invalid refcount&quot;</span><span class="p">);</span>
	<span class="n">assert_equal</span><span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Invalid length&quot;</span><span class="p">);</span>
	<span class="n">assert_equal</span><span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Invalid flags&quot;</span><span class="p">);</span>
	<span class="n">assert_equal_ptr</span><span class="p">(</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">frags</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Frags not NULL&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">net_buf_test</span><span class="p">,</span>
		<span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_get_single_buffer</span><span class="p">)</span>
	<span class="p">);</span>

	<span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">net_buf_test</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="api-reference">
<h2>API reference</h2>
<div class="section" id="running-tests">
<h3>Running tests</h3>
<dl class="function">
<dt id="_CPPv215ztest_test_failv">
<span id="ztest_test_fail__void"></span><span class="target" id="Zephyrd0/d3b/group__ztest__test_1gacd6eb423f54dce8544f7c3b1618c0374"></span>void <code class="descclassname"></code><code class="descname">ztest_test_fail</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><br /></dt>
<dd><p>Fail the currently running test. </p>
<p>This is the function called from failed assertions and the like. You probably don&#8217;t need to call it yourself. </p>
</dd></dl>

<dl class="function">
<dt id="_CPPv214unit_test_noopv">
<span id="unit_test_noop__void"></span><span class="target" id="Zephyrd0/d3b/group__ztest__test_1gaeb99bd1d29675ca8c31b519853cec422"></span><em class="property">static</em> void <code class="descclassname"></code><code class="descname">unit_test_noop</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><br /></dt>
<dd><p>Do nothing, successfully. </p>
<p>Unit test / setup function / teardown function that does nothing, successfully. Can be used as a parameter to ztest_unit_test_setup_teardown(). </p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_unit_test_setup_teardown">
<span class="target" id="Zephyrd0/d3b/group__ztest__test_1gafb04820b89dbc76bf28cb5e1c98764f8"></span><code class="descname">ztest_unit_test_setup_teardown</code><span class="sig-paren">(</span>fn, setup, teardown<span class="sig-paren">)</span></dt>
<dd><p>Define a test with setup and teardown functions. </p>
<p>This should be called as an argument to ztest_test_suite. The test will be run in the following order: <em>setup</em>, <em>fn</em>, <em>teardown</em>.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">fn</span></code>: Main test function </li>
<li><code class="docutils literal"><span class="pre">setup</span></code>: Setup function </li>
<li><code class="docutils literal"><span class="pre">teardown</span></code>: Teardown function </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_unit_test">
<span class="target" id="Zephyrd0/d3b/group__ztest__test_1gaf19dfe9baa08c481c11fd0470e30bc3f"></span><code class="descname">ztest_unit_test</code><span class="sig-paren">(</span>fn<span class="sig-paren">)</span></dt>
<dd><p>Define a test function. </p>
<p>This should be called as an argument to ztest_test_suite.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">fn</span></code>: Test function </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_test_suite">
<span class="target" id="Zephyrd0/d3b/group__ztest__test_1ga3108e97488ed30e428955cb0395005fe"></span><code class="descname">ztest_test_suite</code><span class="sig-paren">(</span>name, ...<span class="sig-paren">)</span></dt>
<dd><p>Define a test suite. </p>
<p>This function should be called in the following fashion: <div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">test_suite_name</span><span class="p">,</span>
        <span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_function</span><span class="p">),</span>
        <span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">test_other_function</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">test_suite_name</span><span class="p">);</span>
</pre></div>
</div>
</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">name</span></code>: Name of the testing suite </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_run_test_suite">
<span class="target" id="Zephyrd0/d3b/group__ztest__test_1ga7f76df4df4bf68a605b923fed8e5465c"></span><code class="descname">ztest_run_test_suite</code><span class="sig-paren">(</span>suite<span class="sig-paren">)</span></dt>
<dd><p>Run the specified test suite. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">suite</span></code>: Test suite to run. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="assertions">
<h3>Assertions</h3>
<p>These macros will instantly fail the test if the related assertion fails.
When an assertion fails, it will print the current file, line and function,
alongside a reason for the failure and an optional message. If the config
option <cite>CONFIG_ZTEST_ASSERT_VERBOSE=0</cite>, the assertions will only print the
file and line numbers, reducing the binary size of the test.</p>
<p>Example output for a failed macro from
<cite>assert_equal(buf-&gt;ref, 2, &#8220;Invalid refcount&#8221;)</cite>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Assertion failed at main.c:62: test_get_single_buffer: Invalid refcount (buf-&gt;ref not equal to 2)
Aborted at unit test function
</pre></div>
</div>
<dl class="macro">
<dt id="c.assert">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1ga0f566e167d44382ca40460503074bed3"></span><code class="descname">assert</code><span class="sig-paren">(</span>cond, msg, default_msg<span class="sig-paren">)</span></dt>
<dd><p>Fail the test, if <em>cond</em> is false. </p>
<p>You probably don&#8217;t need to call this macro directly. You should instead use assert_{condition} macros below.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">cond</span></code>: Condition to check </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional, can be NULL. Message to print if <em>cond</em> is false. </li>
<li><code class="docutils literal"><span class="pre">default_msg</span></code>: Message to print if <em>cond</em> is false </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_unreachable">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1ga7c3795c3090e30ea96aee00283baf6d8"></span><code class="descname">assert_unreachable</code><span class="sig-paren">(</span>msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that this function call won&#8217;t be reached. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_true">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1gadf8eda949a4c765f33ca21bf67c8563a"></span><code class="descname">assert_true</code><span class="sig-paren">(</span>cond, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>cond</em> is true. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">cond</span></code>: Condition to check </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_false">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1gaf1bdbdb5a71731fc3cf55d46a667f290"></span><code class="descname">assert_false</code><span class="sig-paren">(</span>cond, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>cond</em> is false. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">cond</span></code>: Condition to check </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_is_null">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1ga3410566a5d441a2891c8c6633a0db7ce"></span><code class="descname">assert_is_null</code><span class="sig-paren">(</span>ptr, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>ptr</em> is NULL. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">ptr</span></code>: Pointer to compare </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_not_null">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1gac45472973dd70f9beab1c7ec3cbe0d86"></span><code class="descname">assert_not_null</code><span class="sig-paren">(</span>ptr, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>ptr</em> is not NULL. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">ptr</span></code>: Pointer to compare </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_equal">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1gaf64ed1402cd639be4f1093adc427f0fd"></span><code class="descname">assert_equal</code><span class="sig-paren">(</span>a, b, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>a</em> equals <em>b</em>. </p>
<p><em>a</em> and <em>b</em> won&#8217;t be converted and will be compared directly.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">a</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">b</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_not_equal">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1ga29f4bec916bb996eecf8c78aa703865b"></span><code class="descname">assert_not_equal</code><span class="sig-paren">(</span>a, b, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>a</em> does not equal <em>b</em>. </p>
<p><em>a</em> and <em>b</em> won&#8217;t be converted and will be compared directly.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">a</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">b</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.assert_equal_ptr">
<span class="target" id="Zephyrd5/d99/group__ztest__assert_1ga1c97ea01e565a929f833f0397f4eb9f0"></span><code class="descname">assert_equal_ptr</code><span class="sig-paren">(</span>a, b, msg<span class="sig-paren">)</span></dt>
<dd><p>Assert that <em>a</em> equals <em>b</em>. </p>
<p><em>a</em> and <em>b</em> will be converted to <code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></code> before comparing.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">a</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">b</span></code>: Value to compare </li>
<li><code class="docutils literal"><span class="pre">msg</span></code>: Optional message to print if the assertion fails </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
<div class="section" id="mocking">
<h3>Mocking</h3>
<p>These functions allow abstracting callbacks and related functions and
controlling them from specific tests. You can enable the mocking framework by
setting <cite>CONFIG_ZTEST_MOCKING=y</cite> in the configuration file of the test.
The amount of concurrent return values and expected parameters is
limited by <cite>ZTEST_PARAMETER_COUNT</cite>.</p>
<p>Here is an example for configuring the function <cite>expect_two_parameters</cite> to
expect the values <cite>a=2</cite> and <cite>b=3</cite>, and telling <cite>returns_int</cite> to return <cite>5</cite>:</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ztest.h&gt;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">expect_two_parameters</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_check_expected_value</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
	<span class="n">ztest_check_expected_value</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">parameter_tests</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_expect_value</span><span class="p">(</span><span class="n">expect_two_parameters</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">ztest_expect_value</span><span class="p">(</span><span class="n">expect_two_parameters</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">expect_two_parameters</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">returns_int</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ztest_get_return_value</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">return_value_tests</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_returns_value</span><span class="p">(</span><span class="n">returns_int</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">assert_equal</span><span class="p">(</span><span class="n">returns_int</span><span class="p">(),</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">test_main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ztest_test_suite</span><span class="p">(</span><span class="n">mock_framework_tests</span><span class="p">,</span>
		<span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">parameter_test</span><span class="p">),</span>
		<span class="n">ztest_unit_test</span><span class="p">(</span><span class="n">return_value_test</span><span class="p">)</span>
	<span class="p">);</span>

	<span class="n">ztest_run_test_suite</span><span class="p">(</span><span class="n">mock_framework_tests</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<dl class="macro">
<dt id="c.ztest_expect_value">
<span class="target" id="Zephyrd9/dba/group__ztest__mock_1ga58c2f0c0e628e73a2268a3d18b0440d6"></span><code class="descname">ztest_expect_value</code><span class="sig-paren">(</span>func, param, value<span class="sig-paren">)</span></dt>
<dd><p>Tell function <em>func</em> to expect the value <em>value</em> for <em>param</em>. </p>
<p>When using ztest_check_expected_value(), tell that the value of <em>param</em> should be <em>value</em>. The value will internally be stored as an <code class="docutils literal"><span class="pre">uintptr_t</span></code>.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">func</span></code>: Function in question </li>
<li><code class="docutils literal"><span class="pre">param</span></code>: Parameter for which the value should be set </li>
<li><code class="docutils literal"><span class="pre">value</span></code>: Value for <em>param</em> </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_check_expected_value">
<span class="target" id="Zephyrd9/dba/group__ztest__mock_1gae9af6ba8e51738e938763c896f17ea8f"></span><code class="descname">ztest_check_expected_value</code><span class="sig-paren">(</span>param<span class="sig-paren">)</span></dt>
<dd><p>If <em>param</em> doesn&#8217;t match the value set by ztest_expect_value(), fail the test. </p>
<p>This will first check that does <em>param</em> have a value to be expected, and then checks whether the value of the parameter is equal to the expected value. If either of these checks fail, the current test will fail. This must be called from the called function.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">param</span></code>: Parameter to check </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_returns_value">
<span class="target" id="Zephyrd9/dba/group__ztest__mock_1ga2ec539b4c0f3e4efb695213b4fd08c2c"></span><code class="descname">ztest_returns_value</code><span class="sig-paren">(</span>func, value<span class="sig-paren">)</span></dt>
<dd><p>Tell <em>func</em> that it should return <em>value</em>. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">func</span></code>: Function that should return <em>value</em> </li>
<li><code class="docutils literal"><span class="pre">value</span></code>: Value to return from <em>func</em> </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_get_return_value">
<span class="target" id="Zephyrd9/dba/group__ztest__mock_1ga31dcd5b5a3596a7404a771a2d32f3a39"></span><code class="descname">ztest_get_return_value</code></dt>
<dd><p>Get the return value for current function. </p>
<p>The return value must have been set previously with ztest_returns_value(). If no return value exists, the current test will fail.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>The value the current function should return </dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.ztest_get_return_value_ptr">
<span class="target" id="Zephyrd9/dba/group__ztest__mock_1gaa2df2eaeba49019b7a83ac769ea95968"></span><code class="descname">ztest_get_return_value_ptr</code></dt>
<dd><p>Get the return value as a pointer for current function. </p>
<p>The return value must have been set previously with ztest_returns_value(). If no return value exists, the current test will fail.</p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>The value the current function should return as a <code class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></code> </dd>
</dl>
</p>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../usb/usb.html" class="btn btn-neutral float-right" title="USB device stack" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../shell.html" class="btn btn-neutral" title="Shell" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Intel Corporation, Wind River Systems, Inc.
      Last updated on Jan 26, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.6.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>