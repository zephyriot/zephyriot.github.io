

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Shell &mdash; Zephyr Project Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Zephyr Project Documentation" href="../index.html"/>
        <link rel="up" title="Subsystems" href="subsystems.html"/>
        <link rel="next" title="Test Framework" href="test/ztest.html"/>
        <link rel="prev" title="Sensor Drivers" href="sensor.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Zephyr Project
          

          
          </a>

          
            
            
              <div class="version">
                1.6.99
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel/kernel.html">Zephyr Kernel Primer (version 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../application/application.html">Application Development Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting/porting.html">Porting Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/drivers.html">Device Drivers and Device Model</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="subsystems.html">Subsystems</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bluetooth/bluetooth.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="c_library.html">Standard C Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging/index.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="networking/networking.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="power_management.html">Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="sensor.html">Sensor Drivers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Shell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-shell-commands">Using shell commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specific-module-s-commands">Specific module&#8217;s commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#help-commands">Help commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#select-module-commands">Select module commands</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#shell-configuration">Shell configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#infrastructure-level">Infrastructure level</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-subsystem-level">Module/Subsystem level</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration-steps-to-add-shell-functionality-to-a-module">Configuration steps to add shell functionality to a module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-shell-module">Writing a shell module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shell-api-functions">Shell API Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test/ztest.html">Test Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="usb/usb.html">USB device stack</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../samples/samples.html">Samples and Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/kconfig/index.html">Configuration Options Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/code.html">Contributing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSING.html">Licensing of Zephyr Project components</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Zephyr Project</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="subsystems.html">Subsystems</a> &raquo;</li>
      
    <li>Shell</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/subsystems/shell.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="shell">
<span id="id1"></span><h1>Shell</h1>
<div class="section" id="overview">
<h2>Overview</h2>
<p>The Shell enables multiple subsystem to use and expose their shell interface
simultaneously.</p>
<p>Each subbsystem can support shell functionality dynamically by its Kconfig file,
which enables or disables the shell usage for the subsystem.</p>
</div>
<div class="section" id="using-shell-commands">
<h2>Using shell commands</h2>
<p>Use one of the following formats:</p>
<div class="section" id="specific-module-s-commands">
<h3>Specific module&#8217;s commands</h3>
<p>A shell interface exposing subsystem features is a shell module, multiple
modules can be available at the same time.</p>
<dl class="docutils">
<dt><cite>MODULE_NAME COMMAND</cite></dt>
<dd>One of the available modules is “KERNEL”, for the Kernel module.  More
information can be found in <a class="reference internal" href="#c.SHELL_REGISTER" title="SHELL_REGISTER"><code class="xref c c-macro docutils literal"><span class="pre">SHELL_REGISTER</span></code></a>.</dd>
</dl>
</div>
<div class="section" id="help-commands">
<h3>Help commands</h3>
<dl class="docutils">
<dt><cite>help</cite></dt>
<dd>Prints the list of available modules.</dd>
<dt><cite>help MODULE_NAME</cite></dt>
<dd>Prints the names of the available commands for the module.</dd>
<dt><cite>help MODULE_NAME COMMAND</cite></dt>
<dd>Prints help for the module&#8217;s command (the help should show function
goal and required parameters).</dd>
</dl>
</div>
<div class="section" id="select-module-commands">
<h3>Select module commands</h3>
<dl class="docutils">
<dt><cite>select MODULE_NAME</cite></dt>
<dd>Use this command when using the shell only for one module. After entering this
command, you will not need to enter module name in further commands. If
the selected module has set a default shell prompt during its initialization,
the prompt will be changed to that one. Otherwise, the prompt will be
changed to the selected module’s name to reflect the current module in use.</dd>
<dt><cite>select</cite></dt>
<dd>Clears selected module. Restores prompt as well.</dd>
</dl>
</div>
</div>
<div class="section" id="shell-configuration">
<h2>Shell configuration</h2>
<p>There are two levels of configuration: Infrastructure level and Module level.</p>
<div class="section" id="infrastructure-level">
<h3>Infrastructure level</h3>
<p>The option <a class="reference internal" href="../reference/kconfig/CONFIG_CONSOLE_SHELL.html#cmdoption-arg-config-console-shell"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_CONSOLE_SHELL</span></code></a> enables the shell subsystem and enable the
default features of the shell subsystem.</p>
</div>
<div class="section" id="module-subsystem-level">
<h3>Module/Subsystem level</h3>
<p>Each subsystem using the shell service should add a unique flag in its Kconfig file.</p>
<p>Example:</p>
<p>CONFIG_NET_SHELL=y</p>
<p>In the subsystem’s code, the shell usage depends on this config parameter.
This subsystem specific flag should also depend on <a class="reference internal" href="../reference/kconfig/CONFIG_CONSOLE_SHELL.html#cmdoption-arg-config-console-shell"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_CONSOLE_SHELL</span></code></a> flag.</p>
</div>
<div class="section" id="configuration-steps-to-add-shell-functionality-to-a-module">
<h3>Configuration steps to add shell functionality to a module</h3>
<blockquote>
<div><ol class="arabic simple">
<li>Check that <a class="reference internal" href="../reference/kconfig/CONFIG_CONSOLE_SHELL.html#cmdoption-arg-config-console-shell"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_CONSOLE_SHELL</span></code></a> is set to yes.</li>
<li>Add the subsystem unique flag to its Kconfig file.</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="writing-a-shell-module">
<h2>Writing a shell module</h2>
<p>In order to support shell in your subsystem, the application must do the following:</p>
<ol class="arabic simple">
<li>Module configuration flag: Declare a new flag in your subsystem Kconfig file.
It should depend on <cite>:option:`CONFIG_CONSOLE_SHELL`</cite> flag.</li>
<li>Module registration to shell: Add your shell identifier and register its
callback functions in the shell database using <a class="reference internal" href="#c.SHELL_REGISTER" title="SHELL_REGISTER"><code class="xref c c-macro docutils literal"><span class="pre">SHELL_REGISTER</span></code></a>.</li>
</ol>
<p>Optionally, you can use one of the following API functions to override default
behvior and settings:</p>
<ul class="simple">
<li><code class="xref c c-func docutils literal"><span class="pre">shell_register_default_module()</span></code></li>
<li><code class="xref c c-func docutils literal"><span class="pre">shell_register_prompt_handler()</span></code></li>
</ul>
<p>In case of a sample applications as well as test environment, user can choose to
set a default module in code level. In this case, the function
shell_register_default_module should be called after calling SHELL_REGISTER in
application level.  If the function shell_register_prompt_handler was called as
well, the prompt will be changed to that one.  Otherwise, the prompt will be
changed to the selected module’s name, in order to reflect the current module in
use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even if a default module was set in code level, it can be overwritten by
&#8220;select&#8221; shell command.</p>
</div>
<p>You can use  <code class="xref c c-func docutils literal"><span class="pre">shell_register_default_module()</span></code> in the following cases:</p>
<ul class="simple">
<li>Use this command in case of using the shell only for one module.
After entering this command, no need to enter module name in further
commands.</li>
<li>Use this function for shell backward compatibility.</li>
</ul>
<p>More details on those optional functions can be found in
<a class="reference internal" href="#shell-api-functions"><span class="std std-ref">Shell API Functions</span></a>.</p>
</div>
<div class="section" id="shell-api-functions">
<span id="id2"></span><h2>Shell API Functions</h2>
<dl class="type">
<dt id="_CPPv223shell_prompt_function_t">
<span id="shell_prompt_function_t"></span><span class="target" id="Zephyrd9/db7/group____shell__api__functions_1ga9342cdd515fa0460931714cbe4122db5"></span><em class="property">typedef </em><em class="property">const</em> char *(*<code class="descclassname"></code><code class="descname">shell_prompt_function_t</code>)<span class="sig-paren">(</span>void<span class="sig-paren">)</span><br /></dt>
<dd><p>Callback to get the current prompt. </p>
<p><dl class="docutils">
<dt><strong>Return</strong></dt>
<dd>Current prompt string. </dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv210shell_initPKc">
<span id="shell_init__cCP"></span><span class="target" id="Zephyrd9/db7/group____shell__api__functions_1gacf257d208b44fb95b540f5eec975f111"></span>void <code class="descclassname"></code><code class="descname">shell_init</code><span class="sig-paren">(</span><em class="property">const</em> char *<em>prompt</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Initialize shell with optional prompt, NULL in case no prompt is needed. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">prompt</span></code>: Prompt to be printed on serial console. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv230shell_register_app_cmd_handler20shell_cmd_function_t">
<span id="shell_register_app_cmd_handler__shell_cmd_function_t"></span><span class="target" id="Zephyrd9/db7/group____shell__api__functions_1ga75eb658267bde0007a3b11bacb22b644"></span>void <code class="descclassname"></code><code class="descname">shell_register_app_cmd_handler</code><span class="sig-paren">(</span>shell_cmd_function_t <em>handler</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Optionally register an app default cmd handler. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">handler</span></code>: To be called if no cmd found in cmds registered with shell_init. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv229shell_register_prompt_handler23shell_prompt_function_t">
<span id="shell_register_prompt_handler__shell_prompt_function_t"></span><span class="target" id="Zephyrd9/db7/group____shell__api__functions_1ga53fddbdf65b925caf1583634432e2ba4"></span>void <code class="descclassname"></code><code class="descname">shell_register_prompt_handler</code><span class="sig-paren">(</span><a class="reference internal" href="#_CPPv223shell_prompt_function_t" title="shell_prompt_function_t">shell_prompt_function_t</a> <em>handler</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Optionally register a custom prompt callback. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">handler</span></code>: To be called to get the current prompt. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="function">
<dt id="_CPPv229shell_register_default_modulePKc">
<span id="shell_register_default_module__cCP"></span><span class="target" id="Zephyrd9/db7/group____shell__api__functions_1ga81af9956dbab0b20bb1ff20049129f92"></span>void <code class="descclassname"></code><code class="descname">shell_register_default_module</code><span class="sig-paren">(</span><em class="property">const</em> char *<em>name</em><span class="sig-paren">)</span><br /></dt>
<dd><p>Optionally register a default module, to eliminate typing it in shell console or for backwards compatibility. </p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">name</span></code>: Module name. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

<dl class="macro">
<dt id="c.SHELL_REGISTER">
<span class="target" id="Zephyrd9/db7/group____shell__api__functions_1ga63da8c17cbf854cec881881d22ded712"></span><code class="descname">SHELL_REGISTER</code><span class="sig-paren">(</span>shell_name, shell_commands<span class="sig-paren">)</span></dt>
<dd><p>Create shell_module object and set it up for boot time initialization. </p>
<p>This macro defines a shell_module object that is automatically configured by the kernel during system initialization.</p>
<p><dl class="docutils">
<dt><strong>Parameters</strong></dt>
<dd><ul class="breatheparameterlist first last simple">
<li><code class="docutils literal"><span class="pre">shell_name</span></code>: Module name to be entered in shell console.</li>
<li><code class="docutils literal"><span class="pre">shell_commands</span></code>: Array of commands to register. Shell array entries must be packed to calculate array size correctly. </li>
</ul>
</dd>
</dl>
</p>
</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="test/ztest.html" class="btn btn-neutral float-right" title="Test Framework" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sensor.html" class="btn btn-neutral" title="Sensor Drivers" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Intel Corporation, Wind River Systems, Inc.
      Last updated on Jan 26, 2017.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.6.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>